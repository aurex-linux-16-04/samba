From 65c38d7f256cf5fdb44b9945aae4be9f3df14543 Mon Sep 17 00:00:00 2001
From: Jeremy Allison <jra@samba.org>
Date: Fri, 20 Jan 2017 11:48:40 -0800
Subject: [PATCH] s3: VFS: shadow_copy2: Fix length comparison to ensure we
 don't overstep a length.

BUG: https://bugzilla.samba.org/show_bug.cgi?id=12531

Signed-off-by: Jeremy Allison <jra@samba.org>
Reviewed-by: Uri Simchoni <uri@samba.org>
(backported from commit 37ef8d3f65bd1215717eb51b2e1cdb84a7bed348)
---
 source3/modules/vfs_shadow_copy2.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: samba-4.4.5+dfsg/source3/modules/vfs_shadow_copy2.c
===================================================================
--- samba-4.4.5+dfsg.orig/source3/modules/vfs_shadow_copy2.c	2017-03-16 08:57:41.622292212 -0400
+++ samba-4.4.5+dfsg/source3/modules/vfs_shadow_copy2.c	2017-03-16 08:57:41.618292165 -0400
@@ -2094,7 +2094,7 @@
 	}
 
 	if (config->rel_connectpath == NULL &&
-	    strlen(basedir) != strlen(handle->conn->connectpath)) {
+	    strlen(basedir) < strlen(handle->conn->connectpath)) {
 		config->rel_connectpath = talloc_strdup(config,
 			handle->conn->connectpath + strlen(basedir));
 		if (config->rel_connectpath == NULL) {
